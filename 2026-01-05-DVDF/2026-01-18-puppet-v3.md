---
title: Puppet V3 Audit Report
author: Jack
date: January 18, 2026
header-includes:
  - \usepackage{titling}
  - \usepackage{graphicx}
---


Prepared by: [Jack](https://github.com/Jack-OuCJ)

# Table of Contents
- [Severity Classification](#severity-classification)
- [Summary](#summary)
- [Findings](#findings)
  - [High](#high)

# Severity Classification

| Severity         | Description |
| ---------------- | ----------- |
| ![high]          | A **directly** exploitable security vulnerability that leads to stolen/lost/locked/compromised assets or catastrophic denial of service. |
| ![medium]        | Assets not at direct risk, but the function of the protocol or its availability could be impacted. |
| ![low]           | A violation of common best practices or incorrect usage of primitives, which may not currently have a major impact on security. |
| ![informational] | Non-critical comments, recommendations or potential optimizations, not relevant to security. |

# Summary

| Severity         | Number of issues found |
| ---------------- | ---------------------- |
| ![high]          | 1                      |
| ![medium]        | 0                      |
| ![low]           | 0                      |
| ![informational] | 0                      |
| Total            | 1                      |

# Findings

## High

### [H-1] Short 10-minute Uniswap V3 TWAP window can be distorted by a large single-block swap, enabling undercollateralized borrowing within minutes

**Description:** `PuppetV3Pool` uses a 10-minute Uniswap V3 TWAP as its price oracle:

```solidity
uint32 public constant TWAP_PERIOD = 10 minutes;

function _getOracleQuote(uint128 amount) private view returns (uint256) {
    // ⚠️ 10-minute TWAP from a single pool — can be shifted by a large swap
    (int24 arithmeticMeanTick,) = OracleLibrary.consult({
        pool: address(uniswapV3Pool),
        secondsAgo: TWAP_PERIOD
    });
    return OracleLibrary.getQuoteAtTick({
        tick: arithmeticMeanTick,
        baseAmount: amount,
        baseToken: address(token),
        quoteToken: address(weth)
    });
}
```

Although TWAP is more resistant to instant spot manipulation than a pure spot price, it is not immune. An attacker who performs a large swap in the current block forces the Uniswap V3 tick to an extreme value. Once held at that distorted tick for a sufficient fraction of the 10-minute window, the arithmetic mean tick shifts enough to reduce the calculated collateral requirement substantially.

In the challenge scenario, an attacker can:
1. Execute a large DVT→ETH swap in the V3 pool, pushing the tick to its minimum.
2. Wait ~114 seconds (≈19% of the 10-minute window).
3. The TWAP mean tick drops enough that borrowing 1,000,000 DVT requires only the attacker's small WETH balance as collateral.

**Impact:** An attacker with a small capital base (110 DVT + 1 ETH in the challenge) can borrow and steal all 1,000,000 DVT from the lending pool within ~2 minutes, provided they can execute a sufficiently large price-moving swap.

**Proof of Concept:**

```solidity
// 1. Deploy attack contract, transfer player DVT to it
PuppetV3Attacker attacker = new PuppetV3Attacker{value: PLAYER_INITIAL_ETH_BALANCE}(...);
token.transfer(address(attacker), PLAYER_INITIAL_TOKEN_BALANCE);

// 2. Move tick to extreme via large V3 swap
attacker.manipulatePrice();
// → uniswapV3Pool.swap(zeroForOne=true, amountSpecified=largeAmount, sqrtPriceLimitX96=MIN+1)

// 3. Wait 114 seconds — TWAP arithmetic mean tick shifts significantly
skip(114);

// 4. Borrow at distorted collateral requirement
attacker.borrowAndRecover();
// → weth.deposit(), lendingPool.borrow(1_000_000e18), token.transfer(recovery, ...)
```

**Recommended Mitigation:**

1. **Increase the TWAP window significantly:** A 30-minute window raises the capital cost needed to sustain price manipulation. A 1-hour or longer window makes the attack economically infeasible for most liquidity levels.

2. **Use multiple independent oracle sources:** Aggregate the Uniswap V3 TWAP with a Chainlink price feed. Accept a borrow only if both sources agree within a tolerance band.

3. **Add circuit breakers for anomalous price movement:** If the current TWAP deviates more than X% from its 24-hour moving average, pause new borrows.

4. **Check pool liquidity depth:** Before accepting a TWAP as valid, verify that the observed pool has sufficient active liquidity at the current tick range to make manipulation prohibitively expensive.

[high]: https://img.shields.io/badge/-High-red "High"
[medium]: https://img.shields.io/badge/-Medium-orange "Medium"
[low]: https://img.shields.io/badge/-Low-yellow "Low"
[informational]: https://img.shields.io/badge/-Informational-blue "Informational"
